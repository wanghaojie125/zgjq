<!-- Data Tables -->
<link href="/content/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
<link href="/content/css/plugins/iCheck/custom.css" rel="stylesheet">
<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>
                        数据列表
                    </h5>
                </div>
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-sm-9 m-b-xs">
                        </div>
                        <div class="col-sm-1 m-b-xs">
                            <button class="btn btn-white btn-outline" data-toggle="modal" data-target="#addModal"
                                    type="button">添加
                            </button>
                        </div>
                        <div class="col-sm-2 m-b-xs">
                            <select class="input-sm form-control input-s-sm inline" id="select_type">
                                <option value="表面处理" selected>表面处理</option>
                                <option value="热处理">热处理</option>
                                <option value="粗糙度处理">粗糙度处理</option>
                                <option value="铣床">铣床</option>
                                <option value="车床">车床</option>
                            </select>
                        </div>
                    </div>
                    <table class="table table-striped table-bordered table-hover dataTables-example"
                           id="dataTable">
                        <thead>
                        <tr>
                            <th>编号</th>
                            <th>材料</th>
                            <th>处理方式</th>
                            <td>处理类型</td>
                            <th>单价(元/Kg）/(元）</th>
                            <th>更新日期</th>
                            <th>操作记录</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>计算公式</h5>
                </div>
                <div class="ibox-content">
                    <h5>表面处理计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>材料种类单价</th>
                            <th>计算符号</th>
                            <th>重量</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>淬火计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>材料种类单价</th>
                            <th>计算符号</th>
                            <th>重量</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>调质计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>材料种类单价</th>
                            <th>计算符号</th>
                            <th>重量</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>粗糙度计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>材料种类单价</th>
                            <th>计算符号</th>
                            <th>重量</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>平板重量计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>长</th>
                            <th>计算符号</th>
                            <th>宽</th>
                            <th>计算符号</th>
                            <th>高</th>
                            <th>计算符号</th>
                            <th>比重</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>圆棒重量计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>直径</th>
                            <th>计算符号</th>
                            <th>高</th>
                            <th>计算符号</th>
                            <th>比重</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td>*</td>
                            <td></td>
                            <td>*</td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>铣床通槽计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>铣床通槽计算</th>
                            <th>计算符号</th>
                            <th>材料单价</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>铣去材料重量计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>长</th>
                            <th>计算符号</th>
                            <th>宽</th>
                            <th>计算符号</th>
                            <th>深</th>
                            <th>计算符号</th>
                            <th>比重</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>车床计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>材料总重量</th>
                            <th>计算符号</th>
                            <th>各阶梯总重量</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td>-</td>
                            <td></td>
                            <td>M</td>
                        </tr>
                        </tbody>
                    </table>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>车床去除材料</th>
                            <th>计算符号</th>
                            <th>材料单价</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>M</td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="ibox-content">
                    <h5>圆棒阶梯重量计算</h5>
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>直径</th>
                            <th>计算符号</th>
                            <th>高</th>
                            <th>计算符号</th>
                            <th>系数π</th>
                            <th>计算符号</th>
                            <th>比重</th>
                            <th>计算符号</th>
                            <th>结果</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                            <td><i class="fa fa-asterisk"></i></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="modal inmodal fade" id="addModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            onclick="$('#gallaryForm').resetForm();"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="addTitle">添加</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal m-t" id="gallaryForm">
                        <input type="hidden" value="0" id="id" name="id">
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><span style="color:red;">*</span>处理方式：</label>
                            <div class="col-sm-8">
                                <input id="name" name="name" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><span style="color:red;">*</span>处理类型：</label>
                            <div class="col-sm-8">
                                <select id="type" name="type" class="form-control">
                                    <option value="表面处理" selected>表面处理</option>
                                    <option value="热处理">热处理</option>
                                    <option value="粗糙度处理">粗糙度处理</option>
                                    <option value="铣床">铣床</option>
                                    <option value="车床">车床</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><span style="color:red;">*</span>材料：</label>
                            <div class="col-sm-8">
                                <select id="materials_id" name="materials_id" class="form-control">
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label"><span style="color:red;">*</span>单价(元/Kg）/(元）：</label>
                            <div class="col-sm-8">
                                <input id="price" name="price" type="text" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal"
                            onclick="$('#gallaryForm').resetForm();">关闭
                    </button>
                    <button type="button" id="btnSubmit" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>
    </div>
    <script src="/content/js/plugins/dataTables/dataTables.bootstrap.js"></script>

    <!-- jQuery Validation plugin javascript-->
    <script src="/content/js/plugins/validate/jquery.validate.min.js"></script>
    <script src="/content/js/plugins/validate/messages_zh.min.js"></script>
    <!-- jQuery Form plugin javascript-->
    <script src="/content/js/jquery.form.js"></script>

    <!-- iCheck -->
    <script src="/content/js/plugins/iCheck/icheck.min.js"></script>

    <script type="text/javascript">
        (function ($) {
            $.gallary = {
                init: function () {
                    var _self = this;
                    this.val();
                    this.getData();
                    this.init_materials();
                    $('#btnSubmit').off().on('click', function () {
                        if (_self.val().form()) {
                            _self.submit();
                        }
                    });
                },
                init_materials: function () {
                    $.getJSON("/data/materials_all_data", {}, function (res) {
                        if (res.success) {
                            var html = [];
                            $(res.data).each(function () {
                                html.push('<option value="'+this.id+'">'+this.name+'</option>');
                            })
                            $('#materials_id').html(html.join(''));
                        }
                    })
                },
                submit: function () {
                    var _self = this;
                    var data = $("#gallaryForm").formToObj();
                    var titel = "修改"
                    if (data.id == 0) {
                        titel = "添加"
                    }
                    $.request("/data/save_deal", data, function (res) {
                        if (res.success) {
                            if (_self.table) {
                                _self.table.ajax.reload();
                            }
                            toastr.success(titel, res.msg);
                            $("#userForm").resetForm();
                            $('#addModal').modal('hide');
                        }
                        else {
                            toastr.error(titel, res.msg);
                        }
                    });
                },
                val: function () {
                    return $("#gallaryForm").validate({
                        rules: {
                            name: "required",
                            type: "required",
                            materials_id:'required',
                            price: {
                                required: true,
                                number: true
                            }
                        },
                        messages: {
                            name: "请输入名称",
                            type: "请选择类型",
                            materials_id:'请选择材料',
                            price: {
                                required: "请输入单价",
                                number: "请输入合法的单价"
                            }
                        }
                    });
                },
                table: null,
                getData: function () {
                    var _self = this;
                    this.table = $('#dataTable').DataTable({
                        serverSide: true,
                        searching: false,
                        ordering: false,
                        pagingType: "full_numbers",
                        stateSave: true,
                        bLengthChange: false,
                        ajax: {
                            url: "/data/deal_data",
                            dataSrc: 'data',
                            data: function (d) {
                                var param = {};
                                param.draw = d.draw;
                                param.start = d.start;
                                param.length = d.length;
                                param.type = $('#select_type').val();
                                return param;
                            }
                        },
                        columns: [
                            {data: "id"},
                            {data: "materials_name"},
                            {data: "name"},
                            {data: "type"},
                            {data: "price"},
                            {data: "update_at"},
                            {
                                data: "oper_name",
                                render: function (data, type, row, meta) {
                                    return "编辑会员账号:" + data;
                                }
                            },
                            {
                                data: null,
                                render: function (data, type, row, meta) {
                                    var html = [];
                                    var json = encodeURIComponent(JSON.stringify(row));
                                    html.push('<a data-id="' + row.id + '" data-toggle="modal" data-target="#addModal" data-json="' + json + '" data-oper="edit" href="#">编辑</a>&nbsp;&nbsp;&nbsp;')
                                    return html.join('');
                                }
                            }
                        ],
                        fnDrawCallback: function () {
                            $('a[data-oper="edit"]').off().on('click', function () {
                                var id = $(this).data('id');
                                var json = $(this).data('json');
                                _self.edit(id, json);
                            });
                            $('#select_type').on('change', function () {
                                if (_self.table) {
                                    _self.table.ajax.reload();
                                }
                            });

                        }
                    });
                },
                edit: function (id, json) {
                    var data = JSON.parse(decodeURIComponent(json));
                    $("#gallaryForm").ObjToForm(data);
                    $('#addTitle').text('修改');
                },
            }
            $(function () {
                $.gallary.init();
            });
        })(jQuery)

    </script>
</div>